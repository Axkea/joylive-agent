服务治理
===

## 1. 服务注册

## 1.1 服务注册

在应用启动过程中，注册插件会拦截获取到消费者和服务提供者的初始化方法，会修改其元数据，增加多活和泳道的标签。

后续往注册中心注册的时候就会带有相关的标签了。

## 1.2 服务订阅

1. 服务注册过程中，获取到服务会订阅其相关的治理策略
2. 代理的微服务配置中，可以配置预热的服务名称，在代理启动过程中会提前订阅相关的治理策略。

## 1.3 优雅启动

1. 拦截注册中心事件，把注册放到延迟队列
2. 拦截应用生命周期，在应用服务就绪前，同步等待订阅的服务策略就绪
3. 在流控相关插件里面，会对进入的请求进行判断，如果代理还没有就绪则拒绝
4. 服务策略同步完成，在代理就绪的时候，再次进行注册。
5. 确保消费者拿到地址后，后端服务已经就绪

## 1.4 优雅停机

1. 通过系统钩子，拦截到关闭事件，设置代理的状态为关闭
2. 在流控相关插件里面，会对进入的请求进行判断，如果代理还没有就绪则拒绝
3. 确保关闭过程中，新进的请求不在处理。

## 2. 多活流量治理

## 3. 泳道治理

## 4. 微服务治理

### 4.1 集群策略

### 4.2 限流

### 4.3 负载均衡

### 4.4 标签路由

## 5. 优雅启动和停机
